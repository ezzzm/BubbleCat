---
// 导入你网站的主要布局组件
import MainGridLayout from "../layouts/MainGridLayout.astro";

// ===============================================
// == 在这里定义你的播放列表！这是你未来唯一需要修改的地方 ==
// ===============================================
const playlist = [
	{
		title: "孤独摇滚 - 第1集",
		url: "https://pub-954ecf537a9d4e45b78d5f14f7bf7a99.r2.dev/%5BAirota%5D%5BBOCCHI%20THE%20ROCK!%5D%5B01%5D%5BBDRip%201080p%20AVC%20AAC%5D%5BCHS%5D_batch.mp4",
	},
	{
		title: "孤独摇滚 - 第2集",
		url: "https://pub-954ecf537a9d4e45b78d5f14f7bf7a99.r2.dev/%5BAirota%5D%5BBOCCHI%20THE%20ROCK!%5D%5B02%5D%5BBDRip%201080p%20AVC%20AAC%5D%5BCHS%5D_batch.mp4",
	},
	{
		title: "孤独摇滚 - 第3集",
		url: "https://pub-954ecf537a9d4e45b78d5f14f7bf7a99.r2.dev/%5BAirota%5D%5BBOCCHI%20THE%20ROCK!%5D%5B03%5D%5BBDRip%201080p%20AVC%20AAC%5D%5BCHS%5D_batch.mp4",
	},
	{
		title: "幸运星 - 第1集",
		url: "https://pub-954ecf537a9d4e45b78d5f14f7bf7a99.r2.dev/%E3%80%901080P_BDRip%E3%80%91%E5%B9%B8%E8%BF%90%E6%98%9F%20%E3%80%90%E5%8D%8E%E7%9B%9F%E5%AD%97%E5%B9%95%E7%BB%84%E3%80%91%20-%201.%E5%A5%94%E9%A9%B0%E7%9A%84%E5%A5%B3%E5%AD%A9(Av2243843%2CP1).mp4",
	},
	{
		title: "幸运星 - 第2集",
		url: "https://pub-954ecf537a9d4e45b78d5f14f7bf7a99.r2.dev/%E3%80%901080P_BDRip%E3%80%91%E5%B9%B8%E8%BF%90%E6%98%9F%20%E3%80%90%E5%8D%8E%E7%9B%9F%E5%AD%97%E5%B9%95%E7%BB%84%E3%80%91%20-%202.%E5%8A%AA%E5%8A%9B%E4%B8%8E%E7%BB%93%E6%9E%9C(Av2243843%2CP2).mp4",
	},
	{
		title: "幸运星 - 第3集",
		url: "https://pub-954ecf537a9d4e45b78d5f14f7bf7a99.r2.dev/%E3%80%901080P_BDRip%E3%80%91%E5%B9%B8%E8%BF%90%E6%98%9F%20%E3%80%90%E5%8D%8E%E7%9B%9F%E5%AD%97%E5%B9%95%E7%BB%84%E3%80%91%20-%203.%E5%90%84%E5%BC%8F%E5%90%84%E6%A0%B7%E7%9A%84%E4%BA%BA%E4%BB%AC(Av2243843%2CP3).mp4",
	},
	// 你可以在这里继续添加更多视频...
];
---

<MainGridLayout title="动漫放映室">
  <div class="card-base z-10 px-6 md:px-9 pt-6 pb-4 relative w-full rounded-[var(--radius-large)] space-y-6">
    
    <div>
        <h1 class="text-3xl font-bold mb-2">动漫放映室</h1>
        <p class="text-gray-600 dark:text-gray-400">
          欢迎来到Bdu同人交流会动漫放映室！请在下方选择集数观看。
        </p>
    </div>

    <!-- 唯一的 Plyr.io 视频播放器 -->
    <div class="plyr__video-embed" id="player">
        <video controls playsinline>
            <source src={playlist[0].url} type="video/mp4" />
        </video>
    </div>

    <!-- 播放列表按钮 -->
    <div id="playlist-controls">
      <h3 class="text-xl font-semibold mb-3">播放列表</h3>
      <div class="flex flex-wrap gap-2">
        {playlist.map((video) => (
          <button 
            class="playlist-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-blue-500 hover:text-white transition"
            data-video-src={video.url}
          >
            {video.title}
          </button>
        ))}
      </div>
    </div>

    <p class="text-sm text-gray-500">
      <strong>如何一起看：</strong> 点击播放器上的“一起看”图标，创建或加入房间，同步观影。
    </p>

    <!-- Giscus 评论区，放在主卡片的底部 -->
    <div id="giscus-container" class="border-t border-gray-200 dark:border-gray-700 pt-6">
    <script 
        src="https://giscus.app/client.js"
        data-repo="ezzzm/Bubblecat"
        data-repo-id="R_kgDOPnrAKA"
        data-category="Announcements"
        data-category-id="DIC_kwDOPnrAKM4Cu1Yw"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
    </script>
    </div>

  </div>
</MainGridLayout>

<!-- ======================================================= -->
<!-- ==        只为这个页面加载的脚本区域                 == -->
<!-- ======================================================= -->

<!-- 初始化 Plyr 和 播放列表逻辑 的脚本 -->
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const player = new Plyr('video');

    const playlistButtons = document.querySelectorAll('.playlist-btn');
    playlistButtons.forEach(button => {
      button.addEventListener('click', () => {
        const newVideoSrc = button.getAttribute('data-video-src');
        if (newVideoSrc) {
          player.source = {
            type: 'video',
            sources: [{ src: newVideoSrc, type: 'video/mp4' }],
          };
          player.play();
        }
      });
    });
  });
</script>

<!-- VideoTogether 脚本 -->
<script is:inline src="https://2gether.video/release/extension.website.user.js"></script>